version: '3.8'

networks:
  mediator:
    driver: bridge

services:
  mediatordbhost:
    container_name: mediatordbhost
    hostname: mediatordbhost
    image: postgres:12
    env_file:
      - ./.env
    ports:
      - $POSTGRES_EXTERNAL_PORT:$POSTGRES_INTERNAL_PORT
    networks:
      mediator:
          null
    restart: unless-stopped
    volumes:
      - $MOUNT_PGDATA:$PGDATA
  mediatorapi:
    container_name: mediatorapi
    hostname: mediatorapi
    env_file:
      - ./.env
    build:
      context: ./mediator
      dockerfile: Dockerfile
      args:
        - SERVER_INTERNAL_PORT=$SERVER_INTERNAL_PORT
        - POSTGRES_HOST=$POSTGRES_HOST
        - POSTGRES_INTERNAL_PORT=$POSTGRES_INTERNAL_PORT
        - POSTGRES_DB=$POSTGRES_DB
        - POSTGRES_USER=$POSTGRES_USER
        - POSTGRES_PASSWORD=$POSTGRES_PASSWORD
        - API_WORK_DIR=$API_WORK_DIR
        - MAIL_HOST=$MAIL_HOST
        - MAIL_PORT=$MAIL_PORT
        - MAIL_USERNAME=$MAIL_USERNAME
        - MAIL_PASSWORD=$MAIL_PASSWORD
        - MAIL_PROPERTIES_MAIL_SMTP_AUTH=$MAIL_PROPERTIES_MAIL_SMTP_AUTH
        - MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE=$MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE
    depends_on:
      - mediatordbhost
    ports:
      - $SERVER_EXTERNAL_PORT:$SERVER_INTERNAL_PORT
    networks:
      mediator:
          null
    restart: unless-stopped
    volumes:
      - ./mediator/src/main/:$API_WORK_DIR/src/main
      - ./mediator/src/test:$API_WORK_DIR/src/test
      - ./mediator/target:$API_WORK_DIR/target
      - ./mediator/libs:$API_WORK_DIR/libs
      - ./mediator/:$API_WORK_DIR
  # mediatorweb:
  #   container_name: mediatorweb
  #   hostname: mediatorweb
  #   env_file:
  #     - ./.env
  #   build:
  #     context: ./web
  #     dockerfile: Dockerfile
  #     args:
  #       - WEB_WORK_DIR=$WEB_WORK_DIR
  #   ports:
  #     - $WEB_EXTERNAL_PORT:$WEB_INTERNAL_PORT
  #   volumes:
  #     - ./web/src:$WEB_WORK_DIR/src
  #     - ./web/config:$WEB_WORK_DIR/config
  #   networks:
  #     mediator:
  #         null
  #   restart: unless-stopped
