FROM openjdk:11.0.15

ARG SERVER_INTERNAL_PORT
ARG POSTGRES_HOST
ARG POSTGRES_INTERNAL_PORT
ARG POSTGRES_DB
ARG POSTGRES_USER
ARG POSTGRES_PASSWORD
ARG API_WORK_DIR
ARG MAIL_HOST
ARG MAIL_PORT
ARG MAIL_USERNAME
ARG MAIL_PASSWORD
ARG MAIL_PROPERTIES_MAIL_SMTP_AUTH
ARG MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE

WORKDIR ${API_WORK_DIR}

RUN apt update
RUN apt upgrade -y
RUN apt install -y sshpass sudo

COPY . .

RUN ./mvnw clean package -DskipTests -q

EXPOSE ${SERVER_INTERNAL_PORT}

CMD ["./mvnw", "spring-boot:run"]