FROM openjdk:11.0.15

ARG SERVER_INTERNAL_PORT
ARG POSTGRES_HOST
ARG POSTGRES_INTERNAL_PORT
ARG POSTGRES_DB
ARG POSTGRES_USER
ARG POSTGRES_PASSWORD
ARG API_WORK_DIR
ARG MAIL_HOST
ARG MAIL_PORT
ARG MAIL_USERNAME
ARG MAIL_PASSWORD
ARG MAIL_PROPERTIES_MAIL_SMTP_AUTH
ARG MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE
ARG SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_KEYCLOAK_CLIENT_ID
ARG SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_KEYCLOAK_AUTHORIZATION_GRANT_TYPE
ARG SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_KEYCLOAK_SCOPE
ARG SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_KEYCLOAK_ISSUER_URI
ARG SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_KEYCLOAK_USER_NAME_ATTRIBUTE
ARG SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_ISSUER_URI

WORKDIR ${API_WORK_DIR}

RUN apt update
RUN apt upgrade -y
RUN apt install -y sshpass sudo

COPY . .

RUN ./mvnw clean package -DskipTests -q

EXPOSE ${SERVER_INTERNAL_PORT}

CMD ["./mvnw", "spring-boot:run"]